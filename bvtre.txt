  
  microservices:
    build:
      context: ./
      dockerfile: ./apps/microservices/Dockerfile
    depends_on:
      - rabbitmq
    ports:
      - 5125:5125
    volumes:
      - .:/usr/src/app 
      - /usr/src/app/node_modules
    restart: always
    command: npm run start:dev microservices 
    container_name: microservices


  auth:
    build:
      context: ./
      dockerfile: ./apps/auth/Dockerfile
    env_file:
      - apps/auth/.development.env
    depends_on:
      - rabbitmq
      - auth_postgres
    ports:
      - 5126:5126
    volumes:
      - .:/usr/src/app 
      - /usr/src/app/node_modules
    command: npm run start:dev auth 
    restart: always
    container_name: auth


  auth_postgres:
    image: postgres:12
    env_file:
      -  apps/auth/.development.env
    environment:
      PG_DATA: /var/lib/postgresql/data
      POSTGRES_DB: users_rabbit
    ports:
      - '5432:5432'
    volumes:
      - ./db/data:/var/lib/postgresql/data
    restart: always
    container_name: auth_postgres


  countries:
    build:
      context: ./
      dockerfile: ./apps/countries/Dockerfile
    env_file:
      - apps/countries/.development.env
    depends_on:
      - rabbitmq
      - countries_postgres
    ports:
      - 5127:5127
    volumes:
      - .:/usr/src/app 
      - /usr/src/app/node_modules
    command: npm run start:dev countries 
    restart: always
    container_name: countries

    
  countries_postgres:
    image: postgres:12
    env_file:
      -  apps/countries/.development.env
    environment:
      PG_DATA: /var/lib/postgresql/data
      POSTGRES_DB: countries_rabbit
    ports:
      - '5430:5432'
    volumes:
      - ./db/data:/var/lib/postgresql/data
    restart: always
    container_name: countries_postgres


  facts:
    build:
      context: ./
      dockerfile: ./apps/facts/Dockerfile
    env_file:
      - apps/facts/.development.env
    depends_on:
      - rabbitmq
      - facts_postgres
    ports:
      - 5129:5129
    volumes:
      - .:/usr/src/app 
      - /usr/src/app/node_modules
    command: npm run start:dev facts 
    restart: always
    container_name: facts

    
  facts_postgres:
    image: postgres:12
    env_file:
      -  apps/facts/.development.env
    environment:
      PG_DATA: /var/lib/postgresql/data
      POSTGRES_DB: factsoffilms_rabbit
    ports:
      - '5434:5432'
    volumes:
      - ./db/data:/var/lib/postgresql/data
    restart: always
    container_name: facts_postgres

  films:
    build:
      context: ./
      dockerfile: ./apps/films/Dockerfile
    env_file:
      - apps/films/.development.env
    depends_on:
      - rabbitmq
      - films_postgres
    ports:
      - 5122:5127
    volumes:
      - .:/usr/src/app 
      - /usr/src/app/node_modules
    command: npm run start:dev films 
    restart: always
    container_name: films

    
  films_postgres:
    image: postgres:12
    env_file:
      -  apps/films/.development.env
    environment:
      PG_DATA: /var/lib/postgresql/data
      POSTGRES_DB: films_rabbit
    ports:
      - '5435:5432'
    volumes:
      - ./db/data:/var/lib/postgresql/data
    restart: always
    container_name: films_postgres

  genres:
    build:
      context: ./
      dockerfile: ./apps/genres/Dockerfile
    env_file:
      - apps/genres/.development.env
    depends_on:
      - rabbitmq
      - genres_postgres
    ports:
      - 5130:5128
    volumes:
      - .:/usr/src/app 
      - /usr/src/app/node_modules
    command: npm run start:dev genres 
    restart: always
    container_name: genres

    
  genres_postgres:
    image: postgres:12
    env_file:
      -  apps/films/.development.env
    environment:
      PG_DATA: /var/lib/postgresql/data
      POSTGRES_DB: genres_rabbit
    ports:
      - '5433:5432'
    volumes:
      - ./db/data:/var/lib/postgresql/data
    restart: always
    container_name: genres_postgres


  namesoffilms:
    build:
      context: ./
      dockerfile: ./apps/namesoffilms/Dockerfile
    env_file:
      - apps/namesoffilms/.development.env
    depends_on:
      - rabbitmq
      - namesoffilms_postgres
    ports:
      - 5131:5128
    volumes:
      - .:/usr/src/app 
      - /usr/src/app/node_modules
    command: npm run start:dev namesoffilms 
    restart: always
    container_name: namesoffilms

    
  namesoffilms_postgres:
    image: postgres:12
    env_file:
      -  apps/namesoffilms/.development.env
    environment:
      PG_DATA: /var/lib/postgresql/data
      POSTGRES_DB: namesoffilms_rabbit
    ports:
      - '5431:5432'
    volumes:
      - ./db/data:/var/lib/postgresql/data
    restart: always
    container_name: namesoffilms_postgres
  


  person:
    build:
      context: ./
      dockerfile: ./apps/person/Dockerfile
    env_file:
      - apps/person/.development.env
    depends_on:
      - rabbitmq
      - person_postgres
    ports:
      - 5128:5128
    volumes:
      - .:/usr/src/app 
      - /usr/src/app/node_modules
    command: npm run start:dev person 
    restart: always
    container_name: person

    
  person_postgres:
    image: postgres:12
    env_file:
      -  apps/films/.development.env
    environment:
      PG_DATA: /var/lib/postgresql/data
      POSTGRES_DB: person_rabbit
    ports:
      - '5436:5432'
    volumes:
      - ./db/data:/var/lib/postgresql/data
    restart: always
    container_name: person_postgres

volumes:
  pgdata:



  
  